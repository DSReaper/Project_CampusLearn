const express = require('express'); 
const bodyParser = require('body-parser');
const fs = require('fs').promises;

const router = express()


router.get('/login', (req, res) => {
    fs.readFile( __dirname + "login.ejs")
        .then(contents => {
            res.setHeader("Content-Type", "text/html");
            res.writeHead(200);
            res.send(contents);
        }).catch(err => {
            res.writeHead(500);
            res.end(err);
            return;
        });
});

/*
    Email required -> client side
    Password required -> client side

    Email domain must be @belgiumcampus.ac.za -> server side
    Valid campus email and password -> server side
*/

router.post('/login', (req, res) => {
    const { email, password } = req.body;

    //patterns for email validation
    const lecturer_pattern = /^[^\s@]+@belgiumcampus\.ac\.za$/;
    const student_pattern = /^[^\s@]+@student.belgiumcampus\.ac\.za$/;

    //Check if email matches either pattern amnd identify user type
    if (lecturer_pattern.test(email)) {
        // Lecturer login logic here

        

        //checks if email and password match
        
        /*
            if(email and password match) {
                res.redirect('/lecturer-dashboard'); // Redirect to lecturer dashboard
            }
        */
    } else if (student_pattern.test(email)) {
        // Student login logic here


        //checks if email and password match
        /*
            if(email and password match) {
                res.redirect('/student-dashboard'); // Redirect to student dashboard
            }
        */

    } else {
        return res.status(400).send('Invalid email domain. Please use a @belgiumcampus.ac.za or @student.belgiumcampus.ac.za email.');
    }
});

module.exports = router;